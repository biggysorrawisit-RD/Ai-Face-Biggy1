<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏î‡πÅ‡∏ß‡∏ß‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ AI - ‡∏Ñ‡∏£‡∏π BiGgy</title>
  
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    /* ‡∏ò‡∏µ‡∏°: ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô-‡∏ó‡∏≠‡∏á (Professional School Theme) */
    :root {
      --primary: #0d47a1;
      --secondary: #ffd700;
      --bg-color: #f0f2f5;
      --text-color: #333;
    }
    
    body { font-family: 'Kanit', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: var(--text-color); }
    
    /* ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏¢‡∏ï‡∏±‡∏ß (Sticky Widget) */
    #camera-widget {
      position: fixed; top: 20px; right: 20px; width: 200px; z-index: 1000;
      background: #000; border-radius: 12px; overflow: hidden;
      border: 3px solid var(--secondary); box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    #camera-widget video, #camera-widget canvas { width: 100%; height: 150px; object-fit: cover; transform: scaleX(-1); display: block; }
    #ai-status {
      background: var(--primary); color: white; padding: 5px; text-align: center; font-size: 0.8rem;
    }

    /* Layout */
    .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; margin-right: 240px; } /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á */
    .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; animation: fadeIn 0.5s; }
    
    h1, h2 { color: var(--primary); margin-top: 0; }
    .btn {
      background: var(--primary); color: white; border: none; padding: 12px 25px;
      border-radius: 50px; font-size: 1rem; cursor: pointer; transition: 0.2s; margin: 5px;
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .btn-gold { background: var(--secondary); color: #000; font-weight: bold; }
    
    /* Quiz Styles */
    .choice-btn {
      display: block; width: 100%; padding: 15px; margin: 10px 0; text-align: left;
      background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; transition: 0.2s;
    }
    .choice-btn:hover { background: #e3f2fd; border-color: var(--primary); }
    .choice-btn.selected { background: var(--primary); color: white; }
    textarea { width: 100%; height: 100px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Kanit'; }

    .hidden { display: none; }
    @media (max-width: 768px) {
      #camera-widget { position: relative; width: 100%; top: 0; right: 0; margin-bottom: 20px; }
      .container { margin-right: auto; }
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Loader */
    #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:2000; display:flex; flex-direction:column; justify-content:center; align-items:center; }
  </style>
</head>
<body>

  <div id="loader">
    <div style="font-size:4rem;">üß†</div>
    <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö AI...</h3>
  </div>

  <div id="camera-widget">
    <div style="position:relative;">
      <video id="video" autoplay muted playsinline></video>
      <canvas id="overlay" style="position:absolute; top:0; left:0;"></canvas>
    </div>
    <div id="ai-status">
      <div id="user-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</div>
      <div id="emo-label" style="font-size:0.7rem; opacity:0.8;">-</div>
    </div>
  </div>

  <div class="container">
    
    <div id="page-home" class="card">
      <h1>üè´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏î‡πÅ‡∏ß‡∏ß‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (AI School)</h1>
      <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢ AI</p>
      
      <div id="login-section" style="text-align:center; padding:20px; background:#f9f9f9; border-radius:10px;">
        <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</h3>
        <p style="color:red; font-size:0.9rem;">* ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô *</p>
        <div id="menu-area" class="hidden">
           <hr>
           <h3 style="color:var(--primary);">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì <span id="welcome-name">...</span></h3>
           <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
           <button class="btn btn-gold" onclick="startQuiz('career')">üéØ ‡∏ß‡∏±‡∏î‡πÅ‡∏ß‡∏ß‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (10 ‡∏Ç‡πâ‡∏≠)</button>
           <button class="btn" onclick="startQuiz('com')">üíª ‡∏ß‡∏±‡∏î‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (5 ‡∏Ç‡πâ‡∏≠)</button>
        </div>
      </div>
      
      <div style="margin-top:20px; text-align:center;">
        <small>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô? <a href="#" onclick="showRegister()">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</a></small>
      </div>
    </div>

    <div id="page-register" class="card hidden">
      <h2>üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
      <input type="text" id="reg-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡πÄ‡∏ä‡πà‡∏ô ‡∏î.‡∏ä.‡∏°‡∏µ‡∏î‡∏µ ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)" style="width:100%; padding:10px; margin-bottom:10px;">
      <p>‡∏°‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á:</p>
      <button class="btn" onclick="registerFace()">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
      <button class="btn" style="background:#ccc;" onclick="location.reload()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>

    <div id="page-quiz" class="card hidden">
      <h2 id="quiz-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
      <div id="quiz-container"></div>
      <div style="margin-top:20px; text-align:right;">
        <button id="btn-next" class="btn hidden" onclick="nextQuestion()">‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è</button>
      </div>
    </div>

    <div id="page-result" class="card hidden" style="text-align:center;">
      <div style="font-size:4rem;">üéâ</div>
      <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ AI</h2>
      <div id="result-content" style="text-align:left; background:#e8f5e9; padding:20px; border-radius:10px; margin-bottom:20px;"></div>
      <button class="btn" onclick="location.reload()">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

  </div>

  <script>
    // ==========================================
    // ‚ö†Ô∏è ‡πÉ‡∏™‡πà URL ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy (Apps Script) ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
    // ==========================================
    const GAS_URL = '‡πÉ‡∏™‡πà_URL_‡∏à‡∏≤‡∏Å_APPS_SCRIPT_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ'; 
    
    const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö
    let faceMatcher = null;
    let currentUser = null;
    let quizType = '';
    let qIndex = 0;
    let score = 0;
    let writtenAns = '';
    
    // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ---
    const quizCareer = [
      { q: "1. ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏µ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏∞‡πÑ‡∏£?", choices: ["‡∏ß‡∏≤‡∏î‡∏Ñ‡∏±‡∏ó‡πÄ‡∏≠‡∏≤‡∏ó‡πå/‡∏ó‡∏≥‡∏â‡∏≤‡∏Å (‡∏®‡∏¥‡∏•‡∏õ‡πå)", "‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì/‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)", "‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå/‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏ü (‡∏ä‡πà‡∏≤‡∏á)", "‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£/‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô (‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£)"] },
      { q: "2. ‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏ä‡∏≠‡∏ö‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?", choices: ["‡∏™‡∏≠‡∏ô‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ/DIY", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß/‡∏ß‡∏¥‡∏ó‡∏¢‡πå", "‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏Å‡∏î‡πÄ‡∏à‡πá‡∏ï/‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå", "Vlog ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß/‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå"] },
      { q: "3. ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á?", choices: ["‡∏ä‡∏∏‡∏î‡∏™‡∏µ/‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤", "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠/‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á", "‡∏ä‡∏∏‡∏î‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏á/‡∏ï‡∏±‡∏ß‡∏ï‡πà‡∏≠", "‡πÑ‡∏°‡∏Ñ‡πå/‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ"] },
      { q: "4. ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?", choices: ["‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå", "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•", "‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡∏•‡∏≠‡∏á‡∏ñ‡∏π‡∏Å", "‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠/‡πÄ‡∏à‡∏£‡∏à‡∏≤"] },
      { q: "5. ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç?", choices: ["‡∏®‡∏¥‡∏•‡∏õ‡∏∞/‡∏î‡∏ô‡∏ï‡∏£‡∏µ", "‡∏Ñ‡∏ì‡∏¥‡∏ï/‡∏ß‡∏¥‡∏ó‡∏¢‡πå", "‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û", "‡∏†‡∏≤‡∏©‡∏≤/‡∏™‡∏±‡∏á‡∏Ñ‡∏°"] },
      { q: "6. ‡∏ñ‡πâ‡∏≤‡πÇ‡∏•‡∏Å‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏û‡∏•‡∏±‡∏á...", choices: ["‡πÄ‡∏™‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°", "‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏à‡∏Ñ‡∏ô/‡∏£‡∏π‡πâ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï", "‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£", "‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏©‡∏≤"] },
      { q: "7. ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà...", choices: ["‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠/‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà", "‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πá‡∏ö/‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®", "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô/‡πÑ‡∏ã‡∏ï‡πå‡∏á‡∏≤‡∏ô", "‡∏û‡∏ö‡∏õ‡∏∞‡∏ú‡∏π‡πâ‡∏Ñ‡∏ô/‡πÄ‡∏ß‡∏ó‡∏µ"] },
      { q: "8. ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏°‡∏±‡∏Å‡∏ä‡∏°‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì...", choices: ["‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πà‡∏á/‡∏°‡∏µ‡∏™‡πÑ‡∏ï‡∏•‡πå", "‡∏â‡∏•‡∏≤‡∏î/‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö", "‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏á", "‡∏Ñ‡∏∏‡∏¢‡∏™‡∏ô‡∏∏‡∏Å/‡πÄ‡∏ü‡∏£‡∏ô‡∏î‡πå‡∏•‡∏µ‡πà"] },
      { q: "9. ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?", choices: ["‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•/‡∏™‡∏î‡πÉ‡∏™", "‡∏Ç‡∏≤‡∏ß‡∏î‡∏≥/‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢", "‡πÄ‡∏°‡∏ó‡∏±‡∏•‡∏•‡∏¥‡∏Ñ/‡πÄ‡∏ó‡πà", "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô/‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥"] },
      { q: "10. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠?", choices: ["‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞", "‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏´‡∏°‡πà", "‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå", "‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏Ñ‡∏ô"] },
      { type: "text", q: "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 5 ‡∏õ‡∏µ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£? (AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö)" }
    ];

    const quizCom = [
      { q: "1. ‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?", choices: ["RAM", "CPU", "Harddisk", "Mouse"], ans: 1 },
      { q: "2. ‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ (OS)?", choices: ["Microsoft Word", "Google Chrome", "Windows 11", "Facebook"], ans: 2 },
      { q: "3. ‡∏Å‡∏≤‡∏£‡∏Å‡∏î Ctrl+C ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏î?", choices: ["‡∏ß‡∏≤‡∏á (Paste)", "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å (Copy)", "‡∏ï‡∏±‡∏î (Cut)", "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Save)"], ans: 1 },
      { q: "4. ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏•‡∏≤‡∏°‡∏ï‡∏±‡∏î‡πÉ‡∏ô Flowchart ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á?", choices: ["‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô", "‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à", "‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•", "‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á"], ans: 1 },
      { q: "5. ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ?", choices: ["Search Engine", "Web Browser", "Social Media", "‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠"], ans: 3 }
    ];

    // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ---
    window.onload = async () => {
      startVideo();
      try {
        await Promise.all([
          faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
          faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
          faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),
          faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL)
        ]);
        await loadUsers(); // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å Sheet
        document.getElementById('loader').style.display = 'none';
      } catch(e) { console.error(e); alert("Error loading AI. ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Internet"); }
    };

    // --- AI & Camera Logic ---
    async function startVideo() {
      const video = document.getElementById('video');
      const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
      video.srcObject = stream;
      
      video.addEventListener('play', () => {
        const canvas = document.getElementById('overlay');
        const displaySize = { width: video.clientWidth, height: video.clientHeight };
        faceapi.matchDimensions(canvas, displaySize);

        setInterval(async () => {
          const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions().withFaceDescriptors();
          const resized = faceapi.resizeResults(detections, displaySize);
          const ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          if(resized.length > 0) {
            const d = resized[0];
            
            // 1. Emotion
            const ex = d.expressions;
            const emo = Object.keys(ex).reduce((a, b) => ex[a] > ex[b] ? a : b);
            const emoThai = {neutral:"‡∏õ‡∏Å‡∏ï‡∏¥", happy:"‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç", sad:"‡πÄ‡∏®‡∏£‡πâ‡∏≤", angry:"‡πÇ‡∏Å‡∏£‡∏ò", surprised:"‡∏ï‡∏Å‡πÉ‡∏à"}[emo] || emo;
            document.getElementById('emo-label').innerText = `‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå: ${emoThai}`;

            // 2. Recognition
            if(faceMatcher) {
              const match = faceMatcher.findBestMatch(d.descriptor);
              const label = match.toString();
              new faceapi.draw.DrawBox(d.detection.box, { label: label }).draw(canvas);

              if(match.label !== 'unknown') {
                if(currentUser !== match.label) {
                  currentUser = match.label;
                  onUserIdentified(currentUser);
                }
              }
            }
          }
        }, 500);
      });
    }

    async function loadUsers() {
      try {
        const res = await fetch(GAS_URL + '?op=getUsers');
        const users = await res.json();
        if(users.length > 0) {
          const labeled = users.map(u => new faceapi.LabeledFaceDescriptors(u.label, [new Float32Array(u.descriptor)]));
          faceMatcher = new faceapi.FaceMatcher(labeled, 0.6);
        }
      } catch(e) { console.log("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö"); }
    }

    function onUserIdentified(name) {
      document.getElementById('user-name').innerText = name;
      document.getElementById('welcome-name').innerText = name;
      document.getElementById('menu-area').classList.remove('hidden');
    }

    // --- Registration ---
    function showRegister() {
      document.getElementById('page-home').classList.add('hidden');
      document.getElementById('page-register').classList.remove('hidden');
    }

    async function registerFace() {
      const name = document.getElementById('reg-name').value;
      if(!name) return Swal.fire("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠", "warning");

      const video = document.getElementById('video');
      const det = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptor();
      
      if(det) {
        Swal.showLoading();
        await fetch(GAS_URL, {
          method: 'POST', mode: 'no-cors',
          body: JSON.stringify({ action:'register', type:'student', name:name, descriptor: Array.from(det.descriptor) })
        });
        Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", "success").then(()=>location.reload());
      } else {
        Swal.fire("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤", "‡∏Ç‡∏¢‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô", "error");
      }
    }

    // --- Quiz System ---
    function startQuiz(type) {
      quizType = type; qIndex = 0; score = 0; writtenAns = '';
      document.getElementById('page-home').classList.add('hidden');
      document.getElementById('page-quiz').classList.remove('hidden');
      document.getElementById('quiz-title').innerText = (type==='career') ? "üéØ ‡∏ß‡∏±‡∏î‡πÅ‡∏ß‡∏ß‡∏≠‡∏≤‡∏ä‡∏µ‡∏û" : "üíª ‡∏ß‡∏±‡∏î‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
      renderQ();
    }

    function renderQ() {
      const container = document.getElementById('quiz-container');
      const nextBtn = document.getElementById('btn-next');
      container.innerHTML = '';
      nextBtn.classList.add('hidden');
      
      const list = (quizType==='career') ? quizCareer : quizCom;
      const q = list[qIndex];

      if(q.type === 'text') {
        container.innerHTML = `<h3>${q.q}</h3><textarea id="ans-text"></textarea>`;
        nextBtn.classList.remove('hidden');
        nextBtn.onclick = () => { writtenAns = document.getElementById('ans-text').value; finishQuiz(); };
      } else {
        container.innerHTML = `<h3>‡∏Ç‡πâ‡∏≠ ${qIndex+1}: ${q.q}</h3>`;
        q.choices.forEach((c, i) => {
          const btn = document.createElement('div');
          btn.className = 'choice-btn';
          btn.innerText = c;
          btn.onclick = () => {
            document.querySelectorAll('.choice-btn').forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Score logic
            if(quizType === 'com') { if(i === q.ans) score++; }
            else { score += (i===0?1000 : i===1?100 : i===2?10 : 1); } // ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏¢‡∏Å‡∏™‡∏≤‡∏¢
            
            setTimeout(() => {
              qIndex++;
              if(qIndex < list.length) renderQ(); else finishQuiz();
            }, 300);
          };
          container.appendChild(btn);
        });
      }
    }

    async function finishQuiz() {
      document.getElementById('page-quiz').classList.add('hidden');
      document.getElementById('page-result').classList.remove('hidden');
      const content = document.getElementById('result-content');
      content.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• AI...";

      let resultHTML = "";
      
      if(quizType === 'career') {
        // Simple logic analysis
        let s = score;
        let c1 = Math.floor(s/1000); s%=1000; // Art
        let c2 = Math.floor(s/100); s%=100; // Logic
        let c3 = Math.floor(s/10); s%=10; // Mech
        let c4 = s; // Social

        let job = "‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏£‡∏ß‡∏à";
        let desc = "‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ";
        
        if(c1 >= c2 && c1 >= c3) { job = "‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô / ‡∏Ñ‡∏£‡∏µ‡πÄ‡∏≠‡∏ó‡∏µ‡∏ü"; desc = "‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏à‡∏¥‡∏ô‡∏ï‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏á ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö ‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"; }
        else if(c2 >= c1 && c2 >= c3) { job = "‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ / ‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"; desc = "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏£‡∏Å‡∏∞ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏±‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"; }
        else if(c3 >= c2) { job = "‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£ / ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ"; desc = "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏õ‡∏ô‡∏¥‡∏Å"; }
        else { job = "‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ / ‡∏ú‡∏π‡πâ‡∏ô‡∏≥"; desc = "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå"; }

        resultHTML = `<h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ${job}</h3><p>${desc}</p><p><strong>AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô:</strong> "${writtenAns}" <br>-> ‡∏ö‡πà‡∏á‡∏ö‡∏≠‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>`;
        
        // Save
        fetch(GAS_URL, { method:'POST', mode:'no-cors', body:JSON.stringify({action:'save_career', name:currentUser, score:score, written:writtenAns, aiResult:job}) });

      } else {
        let grade = (score >= 4) ? "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (Expert)" : (score >= 3) ? "‡∏î‡∏µ (Good)" : "‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î";
        resultHTML = `<h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score} / 5</h3><p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö:</strong> ${grade}</p><p>‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞!</p>`;
        
        // Save
        fetch(GAS_URL, { method:'POST', mode:'no-cors', body:JSON.stringify({action:'save_comp', name:currentUser, score:score, aiResult:grade}) });
      }
      
      content.innerHTML = resultHTML;
    }
  </script>
</body>
</html>
